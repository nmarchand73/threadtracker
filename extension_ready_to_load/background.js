(()=>{"use strict";const e="undefined"!=typeof browser?browser:chrome;function t(e){const t=new Date(e),a=new Date,s=Math.abs(a-t);return Math.ceil(s/864e5)}console.log("ThreadTracker background script loaded"),e.runtime.onInstalled.addListener((()=>{console.log("ThreadTracker extension installed"),e.storage.local.set({threads:[],settings:{notificationsEnabled:!0,stalledThresholdDays:5,scanFrequency:"daily"}})})),e.runtime.onMessage.addListener(((a,s,o)=>{if("THREADS_UPDATED"===a.type){console.log("Received updated thread data:",a.data),e.storage.local.set({threads:a.data},(()=>{console.log("Thread data stored successfully")}));const s=a.data.filter((e=>"stalled"===e.status));return console.log("Stalled threads:",s),e.storage.local.get("settings",(a=>{(a.settings||{notificationsEnabled:!0}).notificationsEnabled&&s.length>0&&s.forEach((a=>{e.notifications.create(`thread-${a.id}`,{type:"basic",iconUrl:"icon48.svg",title:"Stalled Thread Reminder",message:`Thread "${a.subject}" has been stalled for ${t(a.lastActivity)} days.`,priority:2})}))})),o({success:!0}),!0}}))})();